{% extends "base.html" %}

{% block title %}Governance Map â€” {{ ctx.app_name }}{% endblock %}

{% block nav %}
{% include "partials/nav.html" %}
{% endblock %}

{% block sidebar %}
{% include "partials/sidebar.html" %}
{% endblock %}

{% block content %}
{% if let Some(msg) = ctx.flash %}
<div class="alert alert-success">{{ msg }}</div>
{% endif %}

<div class="page-header">
    <h1>Governance Map</h1>
    <a href="/tor" class="btn btn-sm">All ToRs</a>
</div>

{% if tors.is_empty() %}
<div class="empty-state">
    <p>No Terms of Reference defined yet.</p>
    <a href="/tor/new" class="btn btn-primary">Create your first ToR</a>
</div>
{% else %}

<div class="graph-panel">
    <div class="graph-panel-header">
        <h2>Dependencies</h2>
        <span class="graph-panel-stat" id="gov-stat"></span>
    </div>
    <div class="graph-container" style="height:400px; border:none; border-radius:0;">
        <div class="graph-toolbar" id="gov-toolbar">
            <button class="btn-icon" id="gov-btn-fit" title="Fit all (F)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h6v6"/><path d="M9 21H3v-6"/><path d="M21 3l-7 7"/><path d="M3 21l7-7"/></svg>
            </button>
            <button class="btn-icon" id="gov-btn-zoom-in" title="Zoom in (+)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
            </button>
            <button class="btn-icon" id="gov-btn-zoom-out" title="Zoom out (-)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
            </button>
            <div class="toolbar-divider"></div>
            <button class="btn-icon" id="gov-btn-reset" title="Reset zoom (0)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
            </button>
        </div>
        <div class="graph-canvas" id="gov-canvas">
            <div class="graph-loading" id="gov-loading">
                <span>Loading graph&hellip;</span>
            </div>
        </div>
    </div>
</div>

<section class="section" style="margin-top:1.5rem;">
    <div class="section-header">
        <h2>All Terms of Reference <span style="font-family:var(--font-mono);font-size:0.8125rem;font-weight:400;color:var(--text-muted);">{{ tors.len() }}</span></h2>
    </div>
    <div class="gov-map-grid">
    {% for t in tors %}
        <div class="gov-tor-card">
            <a href="/tor/{{ t.0 }}" class="gov-tor-link">{{ t.2 }}</a>
            <div class="gov-tor-name">{{ t.1 }}</div>
        </div>
    {% endfor %}
    </div>
</section>

{% endif %}

{% include "governance/partials/map_js.html" %}
{% endblock %}

{% extends "base.html" %}

{% block title %}Terms of Reference â€” {{ ctx.app_name }}{% endblock %}

{% block nav %}
{% include "partials/nav.html" %}
{% endblock %}

{% block sidebar %}
{% include "partials/sidebar.html" %}
{% endblock %}

{% block content %}
{% if let Some(msg) = ctx.flash %}
<div class="alert alert-success">{{ msg }}</div>
{% endif %}

<div class="page-header">
    <h1>Terms of Reference</h1>
    {% if ctx.permissions.has("tor.create") %}
    <a href="/tor/new" class="btn btn-primary">New ToR</a>
    {% endif %}
</div>

{% if tors.is_empty() %}
<div class="empty-state">
    <p>No terms of reference have been created yet.</p>
    {% if ctx.permissions.has("tor.create") %}
    <a href="/tor/new" class="btn btn-primary">Create your first ToR</a>
    {% endif %}
</div>
{% else %}
<div class="tor-card-grid">
{% for tor in tors %}
    <div class="tor-card {% if tor.status.as_str() == "active" %}status-active{% else %}status-archived{% endif %}">
        <div class="tor-card-top">
            <span class="tor-card-title">{{ tor.label }}</span>
            <span class="tor-card-id">#{{ tor.id }}</span>
        </div>
        <div class="tor-card-name">{{ tor.name }}</div>

        <div style="display:flex; gap:0.5rem; align-items:center; margin-bottom:0.875rem; flex-wrap:wrap;">
            {% if tor.status.as_str() == "active" %}
            <span class="badge badge-success">Active</span>
            {% else %}
            <span class="badge badge-muted">{{ tor.status }}</span>
            {% endif %}
            <span class="tor-card-cadence">
                <span class="tor-cadence-dot"></span>
                {{ tor.meeting_cadence }}
            </span>
        </div>

        <div class="tor-card-stats">
            <div class="tor-stat">
                <span class="tor-stat-value">{{ tor.member_count }}</span>
                <span class="tor-stat-label">Members</span>
            </div>
            <div class="tor-stat">
                <span class="tor-stat-value">{{ tor.function_count }}</span>
                <span class="tor-stat-label">Functions</span>
            </div>
        </div>

        <div class="tor-card-actions">
            <a href="/tor/{{ tor.id }}" class="btn btn-sm btn-primary">View</a>
            {% if ctx.permissions.has("tor.edit") %}
            <a href="/tor/{{ tor.id }}/edit" class="btn btn-sm">Edit</a>
            {% endif %}
        </div>
    </div>
{% endfor %}
</div>
{% endif %}
{% endblock %}
